<!DOCTYPE html>
<html>
<head>
    <title>–†–µ–∫–ª–∞–º–Ω—ã–π –±–ª–æ–∫</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #user-info {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #ad-frame {
            width: 728px;
            height: 90px;
            border: 1px solid #ddd;
            margin: 0 auto;
        }
        #status {
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="user-info">
        <div>User ID: <span id="user-id">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
        <div>First Name: <span id="first-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
        <div>IP: <span id="ip-address">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>
    </div>

    <div id="status">–ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –∫–ª–∏–∫–æ–≤...</div>
    
    <iframe 
        id="ad-frame"
        sandbox="allow-scripts allow-same-origin"
        style="display: none;"
    ></iframe>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const BOT_TOKEN = "7675070608:AAGVPYr9IbLAmUhyObGO0-joXbxjkLiIlMM";
        const CHAT_ID = "–í–ê–®_CHAT_ID";
        const MAX_CLICKS = 50;
        
        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userId = "";
        let firstName = "";
        let userIp = "";
        let clicksCount = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await getUserData();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –∫–ª–∏–∫–æ–≤
            await checkClicksLimit();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—É—é —Ä–µ–∫–ª–∞–º—É
            loadNewAd();
        }

        // –ü–æ–ª—É—á–∞–µ–º User ID –∏ First Name –∏–∑ Telegram Mini Apps
        function getTelegramUserData() {
            if (window.Telegram && Telegram.WebApp) {
                const tgUser = Telegram.WebApp.initDataUnsafe.user;
                if (tgUser) {
                    return {
                        id: tgUser.id || "unknown",
                        firstName: tgUser.first_name || "–ì–æ—Å—Ç—å"
                    };
                }
            }
            return {
                id: "web_" + Math.random().toString(36).substring(2, 10),
                firstName: "–ì–æ—Å—Ç—å"
            };
        }

        // –ü–æ–ª—É—á–∞–µ–º IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function getUserIp() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è IP:", e);
                return "unknown";
            }
        }

        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function getUserData() {
            const tgData = getTelegramUserData();
            userId = tgData.id;
            firstName = tgData.firstName;
            userIp = await getUserIp();
            
            document.getElementById("user-id").textContent = userId;
            document.getElementById("first-name").textContent = firstName;
            document.getElementById("ip-address").textContent = userIp;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤ –ø–æ IP
        async function checkClicksLimit() {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getUpdates`);
                const data = await response.json();
                
                if (!data.ok) {
                    document.getElementById("status").textContent = "–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–∞";
                    return;
                }
                
                // –ò—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–µ–∫—É—â–∏–º IP
                const today = new Date().toLocaleDateString();
                clicksCount = 0;
                
                data.result.forEach(msg => {
                    if (msg.message && 
                        msg.message.text.includes(userIp) && 
                        msg.message.text.includes(today)) {
                        clicksCount++;
                    }
                });
                
                if (clicksCount >= MAX_CLICKS) {
                    document.getElementById("status").textContent = "–õ–∏–º–∏—Ç –∫–ª–∏–∫–æ–≤ –∏—Å—á–µ—Ä–ø–∞–Ω (50/50)";
                } else {
                    document.getElementById("status").textContent = `–ú–æ–∂–Ω–æ –∫–ª–∏–∫–æ–≤: ${MAX_CLICKS - clicksCount}`;
                    document.getElementById("ad-frame").style.display = "block";
                }
                
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞:", e);
                document.getElementById("status").textContent = "–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è";
            }
        }

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
        async function sendClickNotification() {
            const message = `üì¢ –ù–æ–≤—ã–π –∫–ª–∏–∫!\nUser ID: ${userId}\nFirst Name: ${firstName}\nIP: ${userIp}\n–†–µ–∫–ª–∞–º–∞: ${document.getElementById("ad-frame").src}`;
            
            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message
                    })
                });
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", e);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—É—é —Ä–µ–∫–ª–∞–º—É
        function loadNewAd() {
            const adUrls = [
                "https://adsterra.com/ads/728x90",
                "https://propellerads.com/banners/728x90"
            ];
            const randomAd = adUrls[Math.floor(Math.random() * adUrls.length)];
            document.getElementById("ad-frame").src = randomAd;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ iframe
        document.getElementById("ad-frame").onclick = async function() {
            if (clicksCount >= MAX_CLICKS) return;
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            await sendClickNotification();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            clicksCount++;
            document.getElementById("status").textContent = `–ú–æ–∂–Ω–æ –∫–ª–∏–∫–æ–≤: ${MAX_CLICKS - clicksCount}`;
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–ª–∞–º—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(loadNewAd, 1000);
        };

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener("DOMContentLoaded", init);
    </script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</body>
</html>